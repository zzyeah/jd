<link rel="stylesheet" href="css/search.css">
<div class="logo">
    <img src="https://img10.360buyimg.com/img/jfs/t1/124600/14/15671/184916/5f8d7112E7f52db74/60ee6ba8e8e5ce3a.gif"
        alt="">
</div>
<div class="search-box">
    <!-- 搜索区域 -->
    <div class="search-form">
        <input type="text" id="search-text" placeholder="全球热爱盛典">
        <a href="#">
            <span class="photo-search-btn iconfont">&#xe632;</span></a>
        <button id="search-btn" class="iconfont"> &#xe67c;</button>
        <ul class="search-content">
            <li>asdasd</li>
            <li>asdasd</li>
            <li>asdasd</li>
            <li>asdasd</li>
            <li>asdasd</li>
        </ul>
    </div>
    <!-- 热门关键词 -->
    <div class="hotwords"></div>
    <!-- 购物车 -->
    <div class="settleup"></div>
</div>
<div class="navitems"></div>

<script>
    var searchAjaxTimer = null;
    // 搜索框输入的时候进行获取下拉数据
    $('#search-text').on('input', function (e) {
        var value = $(this).val();
        clearTimeout(searchAjaxTimer);
        if (value) {
            searchAjaxTimer = setTimeout(function () {
                $.ajax({
                    url: 'https://suggest.taobao.com/sug',
                    type: 'get',
                    dataType: 'jsonp',
                    data: {
                        code: 'utf-8',
                        q: value,
                        callback: 'dealData',
                    }
                })
            }, 500);
        }
    }).click(function () {
        $(this).trigger('input');
    });

    // 搜索结果处理函数
    function dealData(data) {
        console.log(data);
        data = data.result;
        var str = '';
        data.forEach(function (item) {
            str += `
            <a href="#">
            <li>
                ${item[0]}
                <span class="productsNum">约${parseInt(item[1])}个商品</span>
                </li>
                </a>`
        });
        $('.search-content').html(str).show();
    }

    $('.search-form').mouseleave(function () {
        $('.search-content').hide();
    });

    // 请求热门关键词数据
    $.ajax({
        url: '/hotwords',
        type: 'get',
        dataType: 'json',
        success: function (data) {
            renderHotWords(data.result);
        }
    });

    // 渲染热门关键词
    function renderHotWords(data) {
        var str = data.reduce(function (prev, icur, index) {
            return prev + `<a href="${icur.href}" class="${index === 0 ? 'red' : ''}">${icur.word}</a>`
        }, '');
        $('.hotwords').html(str)
    }

    setInterval(function () {
        $.ajax({
            url: '/recommendWords',
            dataType: 'json',
            success: function (res) {
                $('.hotwords > a.red').text(res.text);
            }
        })
    }, 3000);
</script>